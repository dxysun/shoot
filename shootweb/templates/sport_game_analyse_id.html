{% extends 'base.html' %}

{% block title %}运动员数据分析-运动员主页{% endblock %}

{% block script %}
    {#    <script src="/static/assets/js/pages/sport_game_analyse_id.js"></script>#}
    <script>
        $(function () {
            var grade = "{{ grades }}";
            var hearts = "{{ hearts }}";
            var r_pos = "{{ r_pos }}";
            var p_pos = "{{ p_pos }}";

            var data1 = [];
            var data_grade = grade.split(",");
            var data_index = [1, 2, 3, 4, 5];

            r_pos = r_pos.split(",");
            p_pos = p_pos.split(",");
            for (var i = 0; i < r_pos.length; i++) {
                data1.push([r_pos[i], p_pos[i]]);
            }

            var options = {
                title: {
                    text: '射击数据图示',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} : {c}'
                },
                legend: {
                    data: ['射击点'],
                    top: 40
                },
                polar: {
                    radius: 170
                },
                angleAxis: {
                    type: 'value',
                    startAngle: 0,
                    minInterval: 30,
                    maxInterval: 30,
                    interval: 30,
                    splitNumber: 12,
                    max: 360

                },
                radiusAxis: {
                    //     axisAngle: 90,
                    min: 5,
                    max: 11,
                    interval: 1,
                    inverse: true
                },
                {% comment %}  dataZoom: [
                      {
                          type: 'slider',
                          radiusAxisIndex: 0,
                          bottom: 40,
                          start: 0,
                          end: 100
                      },
                      {
                          type: 'inside',
                          radiusAxisIndex: 0,
                          start: 0,
                          end: 100
                      }
                  ],{% endcomment %}
                series: [{
                    coordinateSystem: 'polar',
                    // FIXME
                    // 现在必须得设置这个，能不能polar和catesian一样，要不然很多特殊处理。
                    angleAxisIndex: 0,
                    radiusAxisIndex: 0,
                    name: '射击点',
                    type: 'scatter',
                    symbolSize: 5,
                    data: data1
                }]
            };

            var data_level = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
            var data_total = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

            data_grade.forEach(function (item, index) {

                data_total[Math.floor(item) - 1]++;
            });

            var total_grade = {
                color: ['#3398DB'],
                title: {
                    left: 'center',
                    text: '成绩统计图'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { // 坐标轴指示器，坐标轴触发有效
                        type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: [{
                    type: 'category',
                    name: '环数',
                    data: data_level,
                    axisTick: {
                        alignWithLabel: true
                    }
                }],
                yAxis: [{
                    type: 'value',
                    name: '次数'
                }],
                series: [{
                    name: '次数',
                    type: 'bar',
                    barWidth: '50%',
                    data: data_total
                }]
            };

            //   var legendData = ['手部', '肩部', '腰部', '臂部'];
            var legendData = ['x方向', 'y方向'];
            var title = "抖动数据折线图";
            var serieData = [];
            var metaDate = [];
            var xAxisData = [];
            // 10-21-23.txt
            var x_data = "{{ x_data }}";
            var y_data = "{{ y_data }}";
            var xData = x_data.split(",");
            var yData = y_data.split(",");
            var len = xData.length;
            metaDate.push(xData);
            metaDate.push(yData);

            for (var p = 0; p < len; p++) {
                xAxisData.push(p + 1);
            }
            for (var v = 0; v < legendData.length; v++) {
                var serie = {
                    name: legendData[v],
                    type: 'line',
                    symbol: "circle",
                    symbolSize: 10,
                    data: metaDate[v]
                };
                serieData.push(serie)
            }
            var colors = ["#036BC8", "#4A95FF", "#5EBEFC", "#2EF7F3", "#FFFFFF"];
            var option_line_shake = {
                backgroundColor: '#0f375f',
                title: {
                    text: title,
                    textAlign: 'left',
                    textStyle: {color: "#fff", fontSize: "16", fontWeight: "normal"}
                },
                legend: {
                    show: true, left: "right", data: legendData, y: "5%",
                    itemWidth: 18, itemHeight: 12, textStyle: {color: "#fff", fontSize: 14},
                },
                dataZoom: {
                    show: true,
                    realtime: true,
                    start: 0,
                    end: 100
                },
                color: colors,
                grid: {left: '2%', top: "12%", bottom: "5%", right: "5%", containLabel: true},
                tooltip: {trigger: 'axis', axisPointer: {type: 'shadow'}},
                xAxis: [
                    {
                        type: 'category',
                        axisLine: {show: true, lineStyle: {color: '#6173A3'}},
                        axisLabel: {interval: 0, textStyle: {color: '#9ea7c4', fontSize: 14}},
                        axisTick: {show: false},
                        data: xAxisData
                    }
                ],
                yAxis: [
                    {
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {textStyle: {color: '#9ea7c4', fontSize: 14}},
                        axisLine: {show: true, lineStyle: {color: '#6173A3'}},
                    }
                ],
                series: serieData
            };

            var pie_data = [0, 0, 0, 0];
            for (var p1 = 0; p1 < 4; p1++) {

                var d1 = 0;
                for (var j1 = 0; j1 < 60; j1++) {
                    var t1 = Math.random() * 10;
                    d1 = d1 + t1;
                }
                pie_data[p1] = (d1 / 60).toFixed(2);

            }


            var values = hearts.split(",");
            {% comment %}         var Max = 60;
                     var Min = 40;
                     for (k = 0; k < 60; k++) {
                         var Range = Max - Min;
                         var Rand = Math.random();
                         var num = Min + Math.round(Rand * Range); //四舍五入
                         values.push(num);
                     }{% endcomment %}
            var heart_index = [1, 2, 3, 4, 5, 6];
            var option_heart = {
                title: {
                    text: '心率变化数据'
                },
                tooltip: {
                    triggerOn: 'onmousemove',
                    formatter: function (params) {
                        return '次数: ' + params.name + '<br>心跳: ' + params.value + '次';
                    }
                },
                {% comment %}   dataZoom: {
                       show: true,
                       realtime: true,
                       start: 0,
                       end: 20
                   },{% endcomment %}
                xAxis: {
                    boundaryGap: false,
                    data: heart_index,
                    axisLabel: {
                        color: '#000000'
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#BFBFBF'
                        }
                    }
                },
                yAxis: {
                    min: 40,
                    axisLabel: {
                        color: '#000000'
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#BFBFBF'
                        }
                    }
                },
                series: [{
                    type: 'line',
                    data: values,
                    color: ['#2F42FF'],
                    symbolSize: 10,
                    label: {
                        normal: {
                            show: true//圆点上显示值
                        }
                    },
                    markLine: {
                        data: [{
                            type: 'average',
                            name: '平均值'
                        }]
                    }
                }]
            };
            var option_grade = {
                title: {
                    left: 'center',
                    text: '成绩趋势走向图'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        animation: false
                    }
                },
                legend: {
                    data: ['射击成绩'],
                    top: 25
                },
                axisPointer: {
                    link: {
                        xAxisIndex: 'all'
                    }
                },
                {% comment %}  dataZoom: {
                      show: true,
                      realtime: true,
                      start: 40,
                      end: 60,
                      xAxisIndex: [0, 1]
                  },{% endcomment %}
                grid: [{
                    left: 40,
                    right: 40
                }, {
                    left: 40,
                    right: 40
                }],
                xAxis: [{
                    type: 'category',
                    boundaryGap: true,
                    axisLine: {
                        onZero: true
                    },
                    name: '次数',
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: '#fcc',
                            width: 1
                        }
                    },
                    data: data_index
                }, {
                    gridIndex: 1
                }],
                yAxis: [{
                    type: 'value',
                    max: 10,
                    name: '环数',
                    min: 5,
                    interval: 1,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: '#fcc',
                            width: 2
                        }
                    }
                }, {
                    gridIndex: 1
                }],
                series: [{
                    name: '环数',
                    type: 'line',
                    smooth: true,
                    itemStyle: {
                        normal: {
                            color: '#f94427'
                        }
                    },

                    data: data_grade
                }]
            };

              var getDayTime = function () {
                var temp = [];
                for (var i = 0; i < 500; i++) {
                    var hour = i;
                    temp.push(hour);
                }
                return temp;
            };

            var getRandomData = function (val) {
                var temp = [];
                for (var i = 0; i < 500; i++) {
                    var item = Math.random() * 100 - Math.random() * 50;
                    temp.push(item.toFixed(0));
                }

                return temp;
            };
            var myoption = {
                color: [
                    '#66CCFF',
                    '#CC6666',
                    '#66CCCC',
                    '#FF9999',
                    '#26A69A',
                    '#6200EA'
                ],
                title: {
                    text: '枪的抖动图',
                    top: 5
                },
                grid: [{
                    top: '9%',
                    bottom: 0,
                    left: '5%',
                    right: '5%',
                    height: '35%'
                },
                    {
                        top: '50%',
                        bottom: 0,
                        left: '5%',
                        right: '5%',
                        height: '35%'
                    }
                ],

                axisPointer: {
                    link: {
                        xAxisIndex: 'all'
                    }
                },
                legend: {
                    data: ['x方向', 'y方向'],
                    top: 5
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function (params) {
                        if (params instanceof Array) {
                            var idxMap = [{
                                text: '占比',
                                data: []
                            }];
                            var time = params[0].axisValue;
                            for (var i = 0; i < params.length; i++) {
                                var seriesIdx = params[i].seriesId.split(
                                    params[i].seriesId[0]
                                );
                                idxMap[seriesIdx[2]].data.push({
                                    marker: params[i].marker,
                                    seriesName: params[i].seriesName,
                                    data: params[i].data
                                });
                            }

                            return (
                                '<div>' +
                                '<time>' +
                                time +
                                '</time>' +
                                '<br />' +
                                idxMap.map(function (item) {
                                    return (
                                        '<span>' +
                                        item.text +
                                        '</span>' +
                                        item.data
                                            .map(function (i_item) {
                                                return (
                                                    '<p style="margin: 0;padding: 0;">' +
                                                    i_item.marker +
                                                    i_item.seriesName +
                                                    ': ' +
                                                    i_item.data +
                                                    '</p>'
                                                );
                                            })
                                            .join('')
                                    );
                                })
                                    .join('')
                                +
                                '</div>'
                            );
                        }
                    }
                },
                xAxis: [
                    {
                        type: 'category',
                        gridIndex: 0,
                        position: 'bottom',
                        axisLabel: {
                            show: true
                        },
                        data: xAxisData,
                        //show: false,
                        boundaryGap: true
                    },
                    {
                        type: 'category',
                        gridIndex: 1,
                        position: 'bottom',
                        axisLabel: {
                            show: true
                        },
                        data: xAxisData,
                        //show: false,
                        boundaryGap: true
                    }
                ],
                yAxis: [

                    {
                        name: 'x方向',
                        type: 'value',
                        nameTextStyle: {
                            fontSize: 14
                        },
                        gridIndex: 0,
                        inverse: false,
                        splitLine: {
                            lineStyle: {
                                type: 'dashed'
                            }
                        },
                        nameLocation: 'center',
                        nameGap: 30,
                        nameRotate: -90
                    },

                    {
                        name: 'y方向',
                        type: 'value',
                        nameTextStyle: {
                            fontSize: 14
                        },
                        gridIndex: 1,
                        splitLine: {
                            lineStyle: {
                                type: 'dashed'
                            }
                        },
                        position: 'left',
                        nameLocation: 'center',
                        nameGap: 30,
                        nameRotate: -90
                    }
                ],
                dataZoom: [{
                    type: 'slider',
                    show: true,
                    xAxisIndex: [0, 1],
                    start: 0,
                    end: 100
                },
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1]
                    }
                ],
                series: [

                    {
                        name: 'x方向',
                        type: 'line',
                        xAxisIndex: 0,
                        data: xData,
                        yAxisIndex: 0,
                        symbol: 'none',
                        smooth: true
                    },
                    {
                        name: 'y方向',
                        type: 'line',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        data: yData,
                        symbol: 'none',
                        smooth: true,
                        barWidth: 2
                    }
                ]
            };

            var myGrade = echarts.init(document.getElementById('grade'));
            var myChart = echarts.init(document.getElementById('circle'));
            var myTotalGrade = echarts.init(document.getElementById('total_grade'));
            var myLineShake = echarts.init(document.getElementById('line_shake'));
            var myHeart = echarts.init(document.getElementById('heart'));


            myChart.setOption(options);
            myGrade.setOption(option_grade);
            myTotalGrade.setOption(total_grade);
            myLineShake.setOption(myoption);
            myHeart.setOption(option_heart);

        });


    </script>
{% endblock %}
{% block menu %}

    <ul class="nav" id="main-menu">
        <li>
            <a href="{% url 'sport_home' %}"><i class="fa fa-dashboard"></i> 主界面</a>
        </li>
        {% comment %}    <li>
            <a href="{% url 'sport_game_analyse' %}"><i class="fa fa-desktop"></i> 射击数据分析</a>
        </li>{% endcomment %}
        <li>
            <a class="active-menu" href="{% url 'sport_game_history' %}"><i class="fa fa-qrcode"></i> 射击数据</a>
        </li>

    </ul>

{% endblock %}


{% block header %}

    <h1 class="page-header">
        比赛数据分析
    </h1>
    <ol class="breadcrumb">
        <li class="active">分析结果</li>
    </ol>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-6">
            <form role="form">

                <div class="form-group">

                    开始时间:{{ shoot_reports.shoot_date }}&nbsp;{{ shoot_reports.shoot_time }}&nbsp;&nbsp;成绩:{{ shoot_reports.remark }}环

                </div>


            </form>
        </div>
        <div class="col-md-7">
        </div>
    </div>
    <div class="row">
        <div class="panel panel-default">
            <div class="panel-heading">


                <div class="row">
                    <div class="col-md-4">
                        射击信息
                    </div>
                    <div class="col-md-5">


                    </div>
                    <div class="col-md-3">

                    </div>

                </div>
            </div>
            <div class="panel-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>

                            <th>射击时间</th>
                            <th>射击成绩</th>
                            <th>速射时间</th>
                            <th>弹着点坐标(mm)</th>
                            <th>x方向抖动(mm)</th>
                            <th>y方向抖动(mm)</th>
                            <th>心率</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for shoot in shoot_info %}
                            <tr>

                                <td>{{ shoot.grade_detail_time }}</td>
                                <td>{{ shoot.grade }}</td>
                                <td>{{ shoot.rapid_time }}</td>
                                <td>{{ shoot.x_pos }},{{ shoot.y_pos }}</td>
                                <td>{{ shoot.x_shake }}</td>
                                <td>{{ shoot.y_shake }}</td>
                                <td>{{ shoot.heart_rate }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row">

        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    比赛稳定性图
                </div>
                <div class="panel-body">
                    <div id="line_shake" style="width: 100%;height:500%;"></div>
                </div>
            </div>
        </div>
        {% comment %}     <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    成绩稳定性统计图
                </div>
                <div class="panel-body">
                    <div id="total_shake" style="width: 100%;height:500%;"></div>
                </div>
            </div>
        </div>{% endcomment %}
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    比赛成绩分布图
                </div>
                <div class="panel-body">
                    <div id="circle" style="width: 100%;height:500%;"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    成绩趋势走向图
                </div>
                <div class="panel-body">
                    <div id="grade" style="width: 100%;height:500%;"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    比赛成绩统计图
                </div>
                <div class="panel-body">
                    <div id="total_grade" style="width: 100%;height:500%;"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    成绩心率走向图
                </div>
                <div class="panel-body">
                    <div id="heart" style="width: 100%;height:500%;"></div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

